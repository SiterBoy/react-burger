{"ast":null,"code":"import React,{useEffect,useMemo}from'react';import OrderCard from'../components/order-card/order-card';import styles from'./profile-orders-page.module.css';import{useAppDispatch,useAppSelector}from'../store/hooks';import{wsProfileStart,wsProfileClosed}from'../store/slices/profile-orders-slice';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ProfileOrdersPage=()=>{const dispatch=useAppDispatch();const profileOrders=useAppSelector(state=>state.profileOrders);const orders=useMemo(()=>(profileOrders===null||profileOrders===void 0?void 0:profileOrders.orders)||[],[profileOrders===null||profileOrders===void 0?void 0:profileOrders.orders]);const ingredients=useAppSelector(state=>state.ingredients.items);const error=profileOrders===null||profileOrders===void 0?void 0:profileOrders.error;useEffect(()=>{const accessToken=localStorage.getItem('accessToken');if(accessToken){dispatch(wsProfileStart(accessToken));}return()=>{dispatch(wsProfileClosed());};},[dispatch]);React.useEffect(()=>{console.log('ProfileOrdersPage: orders',orders);console.log('ProfileOrdersPage: error',error);console.log('ProfileOrdersPage: profileOrders',profileOrders);},[orders,error,profileOrders]);const getOrderPrice=orderIngredients=>{return orderIngredients.reduce((sum,id)=>{const ingredient=ingredients.find(i=>i._id===id);return ingredient?sum+ingredient.price:sum;},0);};const getOrderIngredients=orderIngredients=>{return orderIngredients.map(id=>ingredients.find(i=>i._id===id)).filter(i=>Boolean(i));};return/*#__PURE__*/_jsxs(\"div\",{className:styles.ordersWrapper,children:[/*#__PURE__*/_jsx(\"h1\",{className:styles.title,children:\"\\u0418\\u0441\\u0442\\u043E\\u0440\\u0438\\u044F \\u0437\\u0430\\u043A\\u0430\\u0437\\u043E\\u0432\"}),error&&/*#__PURE__*/_jsxs(\"div\",{style:{color:'red',marginBottom:16},children:[\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 WebSocket: \",error]}),/*#__PURE__*/_jsx(\"div\",{className:styles.orders,children:orders.map(order=>/*#__PURE__*/_jsx(OrderCard,{order:{number:order.number,name:`Заказ #${order.number}`,date:new Date(order.createdAt).toLocaleString('ru-RU',{hour:'2-digit',minute:'2-digit',day:'numeric',month:'long'}),ingredients:getOrderIngredients(order.ingredients),price:getOrderPrice(order.ingredients),status:order.status}},order._id))})]});};export default ProfileOrdersPage;","map":{"version":3,"names":["React","useEffect","useMemo","OrderCard","styles","useAppDispatch","useAppSelector","wsProfileStart","wsProfileClosed","jsx","_jsx","jsxs","_jsxs","ProfileOrdersPage","dispatch","profileOrders","state","orders","ingredients","items","error","accessToken","localStorage","getItem","console","log","getOrderPrice","orderIngredients","reduce","sum","id","ingredient","find","i","_id","price","getOrderIngredients","map","filter","Boolean","className","ordersWrapper","children","title","style","color","marginBottom","order","number","name","date","Date","createdAt","toLocaleString","hour","minute","day","month","status"],"sources":["/Users/antonkaliberov/Desktop/Обучение реакт/Спринт 1 /react-burger/src/pages/profile-orders-page.tsx"],"sourcesContent":["import React, { useEffect, useMemo } from 'react';\nimport OrderCard from '../components/order-card/order-card';\nimport styles from './profile-orders-page.module.css';\nimport { useAppDispatch, useAppSelector } from '../store/hooks';\nimport { wsProfileStart, wsProfileClosed } from '../store/slices/profile-orders-slice';\nimport { RootState } from '../store/types';\n\nconst ProfileOrdersPage: React.FC = () => {\n  const dispatch = useAppDispatch();\n  const profileOrders = useAppSelector((state: RootState) => state.profileOrders);\n  const orders = useMemo(() => profileOrders?.orders || [], [profileOrders?.orders]);\n  const ingredients = useAppSelector((state: RootState) => state.ingredients.items);\n  const error = profileOrders?.error;\n\n  useEffect(() => {\n    const accessToken = localStorage.getItem('accessToken');\n    if (accessToken) {\n      dispatch(wsProfileStart(accessToken));\n    }\n    return () => {\n      dispatch(wsProfileClosed());\n    };\n  }, [dispatch]);\n\n  React.useEffect(() => {\n    console.log('ProfileOrdersPage: orders', orders);\n    console.log('ProfileOrdersPage: error', error);\n    console.log('ProfileOrdersPage: profileOrders', profileOrders);\n  }, [orders, error, profileOrders]);\n\n  const getOrderPrice = (orderIngredients: string[]) => {\n    return orderIngredients.reduce((sum, id) => {\n      const ingredient = ingredients.find(i => i._id === id);\n      return ingredient ? sum + ingredient.price : sum;\n    }, 0);\n  };\n\n  const getOrderIngredients = (orderIngredients: string[]) => {\n    return orderIngredients\n      .map(id => ingredients.find(i => i._id === id))\n      .filter((i): i is typeof ingredients[number] => Boolean(i));\n  };\n\n  return (\n    <div className={styles.ordersWrapper}>\n      <h1 className={styles.title}>История заказов</h1>\n      {error && (\n        <div style={{ color: 'red', marginBottom: 16 }}>Ошибка WebSocket: {error}</div>\n      )}\n      <div className={styles.orders}>\n        {orders.map(order => (\n          <OrderCard\n            key={order._id}\n            order={{\n              number: order.number,\n              name: `Заказ #${order.number}`,\n              date: new Date(order.createdAt).toLocaleString('ru-RU', { hour: '2-digit', minute: '2-digit', day: 'numeric', month: 'long' }),\n              ingredients: getOrderIngredients(order.ingredients),\n              price: getOrderPrice(order.ingredients),\n              status: order.status\n            }}\n          />\n        ))}\n      </div>\n    </div>\n  );\n};\n\nexport default ProfileOrdersPage; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}