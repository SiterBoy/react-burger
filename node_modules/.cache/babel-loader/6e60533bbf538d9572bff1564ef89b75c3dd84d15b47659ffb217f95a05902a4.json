{"ast":null,"code":"export const BASE_WS_URL='wss://norma.nomoreparties.space';export const wsMiddleware=(wsUrl,actions)=>{return store=>{let socket=null;return next=>action=>{const{dispatch}=store;if(typeof action==='object'&&action!==null&&'type'in action&&typeof action.type==='string'){switch(action.type){case actions.wsStart:if(socket!==null){socket.close();}let url='';let payload=undefined;if('payload'in action&&typeof action.payload==='string'){payload=action.payload;}if(typeof wsUrl==='function'){url=wsUrl(payload);}else{url=wsUrl;}socket=new WebSocket(url);socket.onopen=()=>dispatch({type:actions.wsSuccess});socket.onerror=event=>dispatch({type:actions.wsError,payload:event});socket.onclose=()=>dispatch({type:actions.wsClosed});socket.onmessage=event=>{try{const data=JSON.parse(event.data);if(data.orders){data.orders=data.orders.filter(order=>Array.isArray(order.ingredients)&&order.ingredients.length>0&&order._id&&order.number);}dispatch({type:actions.wsMessage,payload:data});}catch(e){dispatch({type:actions.wsError,payload:e});}};break;case actions.wsClosed:if(socket!==null){socket.close();socket=null;}break;default:break;}}return next(action);};};};","map":{"version":3,"names":["BASE_WS_URL","wsMiddleware","wsUrl","actions","store","socket","next","action","dispatch","type","wsStart","close","url","payload","undefined","WebSocket","onopen","wsSuccess","onerror","event","wsError","onclose","wsClosed","onmessage","data","JSON","parse","orders","filter","order","Array","isArray","ingredients","length","_id","number","wsMessage","e"],"sources":["/Users/antonkaliberov/Desktop/Обучение реакт/Спринт 1 /react-burger/src/store/middleware/ws-middleware.ts"],"sourcesContent":["import { Middleware } from '@reduxjs/toolkit';\nimport type { Order } from '../slices/order-feed-slice';\n\nexport const BASE_WS_URL = 'wss://norma.nomoreparties.space';\n\ninterface WSActions {\n  wsStart: string;\n  wsSuccess: string;\n  wsError: string;\n  wsClosed: string;\n  wsMessage: string;\n}\n\nexport const wsMiddleware = (\n  wsUrl: string | ((param?: string) => string),\n  actions: WSActions\n): Middleware => {\n  return store => {\n    let socket: WebSocket | null = null;\n\n    return (next) => (action) => {\n      const { dispatch } = store;\n      if (typeof action === 'object' && action !== null && 'type' in action && typeof action.type === 'string') {\n        switch (action.type) {\n          case actions.wsStart:\n            if (socket !== null) {\n              socket.close();\n            }\n            let url = '';\n            let payload: string | undefined = undefined;\n            if ('payload' in action && typeof action.payload === 'string') {\n              payload = action.payload;\n            }\n            if (typeof wsUrl === 'function') {\n              url = wsUrl(payload);\n            } else {\n              url = wsUrl;\n            }\n            socket = new WebSocket(url);\n\n            socket.onopen = () => dispatch({ type: actions.wsSuccess });\n            socket.onerror = (event) => dispatch({ type: actions.wsError, payload: event });\n            socket.onclose = () => dispatch({ type: actions.wsClosed });\n            socket.onmessage = (event) => {\n              try {\n                const data = JSON.parse(event.data);\n                if (data.orders) {\n                  data.orders = data.orders.filter((order: Order) => Array.isArray(order.ingredients) && order.ingredients.length > 0 && order._id && order.number);\n                }\n                dispatch({ type: actions.wsMessage, payload: data });\n              } catch (e) {\n                dispatch({ type: actions.wsError, payload: e });\n              }\n            };\n            break;\n          case actions.wsClosed:\n            if (socket !== null) {\n              socket.close();\n              socket = null;\n            }\n            break;\n          default:\n            break;\n        }\n      }\n      return next(action);\n    };\n  };\n}; "],"mappings":"AAGA,MAAO,MAAM,CAAAA,WAAW,CAAG,iCAAiC,CAU5D,MAAO,MAAM,CAAAC,YAAY,CAAGA,CAC1BC,KAA4C,CAC5CC,OAAkB,GACH,CACf,MAAO,CAAAC,KAAK,EAAI,CACd,GAAI,CAAAC,MAAwB,CAAG,IAAI,CAEnC,MAAQ,CAAAC,IAAI,EAAMC,MAAM,EAAK,CAC3B,KAAM,CAAEC,QAAS,CAAC,CAAGJ,KAAK,CAC1B,GAAI,MAAO,CAAAG,MAAM,GAAK,QAAQ,EAAIA,MAAM,GAAK,IAAI,EAAI,MAAM,EAAI,CAAAA,MAAM,EAAI,MAAO,CAAAA,MAAM,CAACE,IAAI,GAAK,QAAQ,CAAE,CACxG,OAAQF,MAAM,CAACE,IAAI,EACjB,IAAK,CAAAN,OAAO,CAACO,OAAO,CAClB,GAAIL,MAAM,GAAK,IAAI,CAAE,CACnBA,MAAM,CAACM,KAAK,CAAC,CAAC,CAChB,CACA,GAAI,CAAAC,GAAG,CAAG,EAAE,CACZ,GAAI,CAAAC,OAA2B,CAAGC,SAAS,CAC3C,GAAI,SAAS,EAAI,CAAAP,MAAM,EAAI,MAAO,CAAAA,MAAM,CAACM,OAAO,GAAK,QAAQ,CAAE,CAC7DA,OAAO,CAAGN,MAAM,CAACM,OAAO,CAC1B,CACA,GAAI,MAAO,CAAAX,KAAK,GAAK,UAAU,CAAE,CAC/BU,GAAG,CAAGV,KAAK,CAACW,OAAO,CAAC,CACtB,CAAC,IAAM,CACLD,GAAG,CAAGV,KAAK,CACb,CACAG,MAAM,CAAG,GAAI,CAAAU,SAAS,CAACH,GAAG,CAAC,CAE3BP,MAAM,CAACW,MAAM,CAAG,IAAMR,QAAQ,CAAC,CAAEC,IAAI,CAAEN,OAAO,CAACc,SAAU,CAAC,CAAC,CAC3DZ,MAAM,CAACa,OAAO,CAAIC,KAAK,EAAKX,QAAQ,CAAC,CAAEC,IAAI,CAAEN,OAAO,CAACiB,OAAO,CAAEP,OAAO,CAAEM,KAAM,CAAC,CAAC,CAC/Ed,MAAM,CAACgB,OAAO,CAAG,IAAMb,QAAQ,CAAC,CAAEC,IAAI,CAAEN,OAAO,CAACmB,QAAS,CAAC,CAAC,CAC3DjB,MAAM,CAACkB,SAAS,CAAIJ,KAAK,EAAK,CAC5B,GAAI,CACF,KAAM,CAAAK,IAAI,CAAGC,IAAI,CAACC,KAAK,CAACP,KAAK,CAACK,IAAI,CAAC,CACnC,GAAIA,IAAI,CAACG,MAAM,CAAE,CACfH,IAAI,CAACG,MAAM,CAAGH,IAAI,CAACG,MAAM,CAACC,MAAM,CAAEC,KAAY,EAAKC,KAAK,CAACC,OAAO,CAACF,KAAK,CAACG,WAAW,CAAC,EAAIH,KAAK,CAACG,WAAW,CAACC,MAAM,CAAG,CAAC,EAAIJ,KAAK,CAACK,GAAG,EAAIL,KAAK,CAACM,MAAM,CAAC,CACnJ,CACA3B,QAAQ,CAAC,CAAEC,IAAI,CAAEN,OAAO,CAACiC,SAAS,CAAEvB,OAAO,CAAEW,IAAK,CAAC,CAAC,CACtD,CAAE,MAAOa,CAAC,CAAE,CACV7B,QAAQ,CAAC,CAAEC,IAAI,CAAEN,OAAO,CAACiB,OAAO,CAAEP,OAAO,CAAEwB,CAAE,CAAC,CAAC,CACjD,CACF,CAAC,CACD,MACF,IAAK,CAAAlC,OAAO,CAACmB,QAAQ,CACnB,GAAIjB,MAAM,GAAK,IAAI,CAAE,CACnBA,MAAM,CAACM,KAAK,CAAC,CAAC,CACdN,MAAM,CAAG,IAAI,CACf,CACA,MACF,QACE,MACJ,CACF,CACA,MAAO,CAAAC,IAAI,CAACC,MAAM,CAAC,CACrB,CAAC,CACH,CAAC,CACH,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}